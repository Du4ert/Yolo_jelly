# YOLO Jellyfish Detector

–°–∏—Å—Ç–µ–º–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∂–µ–ª–µ—Ç–µ–ª–æ–≥–æ –º–∞–∫—Ä–æ–∑–æ–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω–∞ –Ω–∞ –ø–æ–¥–≤–æ–¥–Ω–æ–º –≤–∏–¥–µ–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –Ω–µ–π—Ä–æ—Å–µ—Ç–∏ YOLOv8.

## –¶–µ–ª–µ–≤—ã–µ –≤–∏–¥—ã

| –ö–ª–∞—Å—Å ID | –í–∏–¥ | –¢–∏–ø |
|----------|-----|-----|
| 0 | *Aurelia aurita* | –ú–µ–¥—É–∑–∞ |
| 1 | *Beroe ovata* | –ì—Ä–µ–±–Ω–µ–≤–∏–∫ |
| 2 | *Mnemiopsis leidyi* | –ì—Ä–µ–±–Ω–µ–≤–∏–∫ |
| 3 | *Pleurobrachia pileus* | –ì—Ä–µ–±–Ω–µ–≤–∏–∫ |
| 4 | *Rhizostoma pulmo* | –ú–µ–¥—É–∑–∞ |

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
yolo_jellyfish/
‚îú‚îÄ‚îÄ README.md                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ requirements.txt          # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ data.yaml                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞
‚îú‚îÄ‚îÄ batch_app.py              # GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ batch/                    # –ú–æ–¥—É–ª–∏ –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ core/                 # –Ø–¥—Ä–æ (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã, –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–¥–∞—á)
‚îÇ   ‚îú‚îÄ‚îÄ database/             # –†–∞–±–æ—Ç–∞ —Å –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ ui/                   # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å
‚îú‚îÄ‚îÄ src/                      # –°–∫—Ä–∏–ø—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
‚îÇ   ‚îú‚îÄ‚îÄ extract_frames.py     # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ –∏–∑ –≤–∏–¥–µ–æ
‚îÇ   ‚îú‚îÄ‚îÄ augment.py            # –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ train.py              # –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ detect_video.py       # –î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞ –≤–∏–¥–µ–æ —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º
‚îÇ   ‚îú‚îÄ‚îÄ camera_geometry.py    # –ì–µ–æ–º–µ—Ç—Ä–∏—è –∫–∞–º–µ—Ä—ã –∏ —Ä–∞–∑–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ analyze.py            # –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (matplotlib)
‚îÇ   ‚îú‚îÄ‚îÄ interactive_plot.py   # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (Plotly)
‚îÇ   ‚îî‚îÄ‚îÄ utils.py              # –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ dataset/                  # –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±—É—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ runs/                     # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ output/                   # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –¥–µ—Ç–µ–∫—Ü–∏–∏
```

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### 1. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python -m venv venv
source venv/bin/activate
```

### 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ GPU (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```python
import torch
print(f"CUDA –¥–æ—Å—Ç—É–ø–Ω–∞: {torch.cuda.is_available()}")
print(f"–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else 'CPU'}")
```

---

## –ì—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (batch_app.py)

GUI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –ø–∞–∫–µ—Ç–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–∏–¥–µ–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π:
- –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–π –ø–æ —ç–∫—Å–ø–µ–¥–∏—Ü–∏—è–º
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—á–µ—Ä–µ–¥—å—é –∑–∞–¥–∞—á
- –ì–µ–æ–º–µ—Ç—Ä–∏–∏ –∫–∞–º–µ—Ä—ã –∏ —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
- –ê–Ω–∞–ª–∏–∑–∞ –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –ó–∞–ø—É—Å–∫

```bash
python batch_app.py
```

### –ì–æ—Ä—è—á–∏–µ –∫–ª–∞–≤–∏—à–∏

| –ö–ª–∞–≤–∏—à–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---------|----------|
| `Ctrl+D` | –î–æ–±–∞–≤–∏—Ç—å –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ |
| `Ctrl+M` | –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å |
| `Ctrl+G` | –ì–µ–æ–º–µ—Ç—Ä–∏—è –∏ —Ä–∞–∑–º–µ—Ä—ã |
| `Ctrl+A` | –ê–Ω–∞–ª–∏–∑ –¥–µ—Ç–µ–∫—Ü–∏–π |
| `F5` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å |
| `F6` | –ü–∞—É–∑–∞ |
| `F7` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å |
| `Ctrl+Q` | –í—ã—Ö–æ–¥ |

### –ú–µ–Ω—é "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã"

#### –ì–µ–æ–º–µ—Ç—Ä–∏—è –∏ —Ä–∞–∑–º–µ—Ä—ã (Ctrl+G)

–î–∏–∞–ª–æ–≥ —Å —Ç—Ä–µ–º—è –≤–∫–ª–∞–¥–∫–∞–º–∏:

1. **–ù–∞–∫–ª–æ–Ω –∫–∞–º–µ—Ä—ã (FOE)** ‚Äî –∞–Ω–∞–ª–∏–∑ –≤–∏–¥–µ–æ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã –ø–æ –º–æ—Ä—Å–∫–æ–º—É —Å–Ω–µ–≥—É
2. **–†–∞–∑–º–µ—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤** ‚Äî —Ä–∞—Å—á—ë—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ –¥–∏–Ω–∞–º–∏–∫–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è bbox
3. **–û–±—ä—ë–º –≤–æ–¥—ã** ‚Äî —Ä–∞—Å—á—ë—Ç –æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ –æ–±—ä—ë–º–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤

#### –ê–Ω–∞–ª–∏–∑ –¥–µ—Ç–µ–∫—Ü–∏–π (Ctrl+A)

–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –æ—Ç—á—ë—Ç–æ–≤:
- –í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –≥–ª—É–±–∏–Ω–µ
- –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –¥–µ—Ç–µ–∫—Ü–∏–π
- –°–≤–æ–¥–∫–∞ –ø–æ –≤–∏–¥–∞–º
- –¢–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π HTML-–≥—Ä–∞—Ñ–∏–∫ (–µ—Å–ª–∏ –µ—Å—Ç—å —Ñ–∞–π–ª —Ç—Ä–µ–∫–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏)

#### –ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á–∏ ‚Üí –ê–Ω–∞–ª–∏–∑

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–∑–∞–¥–∞—á–∏ ¬´üìä –ê–Ω–∞–ª–∏–∑ –∏ –≥—Ä–∞—Ñ–∏–∫–∏¬ª —á–µ—Ä–µ–∑ –º–µ–Ω—é –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–ª–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å –∞–≤—Ç–æ–ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–æ–π –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ–ª–µ **¬´–ö–æ–ª–æ–Ω–∫–∏ CTD¬ª** ‚Äî –Ω–æ–º–µ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫ CTD-—Ñ–∞–π–ª–∞ –¥–ª—è –Ω–∞–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ (0-based, —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `6`).

---

## –°–∫—Ä–∏–ø—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏

### 1. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ (extract_frames.py)

–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞–¥—Ä–æ–≤ –∏–∑ –≤–∏–¥–µ–æ –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏.

```bash
python src/extract_frames.py --video –ø—É—Ç—å/–∫/–≤–∏–¥–µ–æ.mp4 --output dataset/raw_frames --interval 15
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--video`, `-v` | ‚Äî | –ü—É—Ç—å –∫ –≤–∏–¥–µ–æ—Ñ–∞–π–ª—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--output`, `-o` | `output/frames` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤ |
| `--interval`, `-i` | 30 | –ò–Ω—Ç–µ—Ä–≤–∞–ª –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏ |

---

### 2. –ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (augment.py)

–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –æ–±—É—á–µ–Ω–∏—è.

```bash
python src/augment.py --images dataset/images/train --labels dataset/labels/train --multiply 4
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--images` | ‚Äî | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--labels` | ‚Äî | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--multiply`, `-m` | 3 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞—É–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–ø–∏–π |

---

### 3. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ (train.py)

–û–±—É—á–µ–Ω–∏–µ YOLO –º–æ–¥–µ–ª–∏.

```bash
python src/train.py --data data.yaml --epochs 150 --model yolov8m.pt
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--data` | `data.yaml` | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–∞—Ç–∞—Å–µ—Ç–∞ |
| `--model` | `yolov8m.pt` | –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å (n/s/m/l/x) |
| `--epochs` | 150 | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö |
| `--imgsz` | 640 | –†–∞–∑–º–µ—Ä –≤—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è |
| `--batch` | 16 | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ |
| `--device` | auto | –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ (0, 1, cpu) |
| `--name` | `jellyfish_v1` | –ò–º—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞ |

---

### 4. –î–µ—Ç–µ–∫—Ü–∏—è –Ω–∞ –≤–∏–¥–µ–æ (detect_video.py)

–î–µ—Ç–µ–∫—Ü–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –≤–∏–¥–µ–æ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π —Ç—Ä–µ–∫–∏–Ω–≥–∞.

```bash
python src/detect_video.py \
    --video –ø—É—Ç—å/–∫/–≤–∏–¥–µ–æ.mp4 \
    --model runs/best/weights/best.pt \
    --track \
    --show-trails \
    --output output/—Ä–µ–∑—É–ª—å—Ç–∞—Ç.mp4 \
    --csv output/–¥–µ—Ç–µ–∫—Ü–∏–∏.csv
```

#### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--video`, `-v` | ‚Äî | –ü—É—Ç—å –∫ –≤—Ö–æ–¥–Ω–æ–º—É –≤–∏–¥–µ–æ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--model`, `-m` | ‚Äî | –ü—É—Ç—å –∫ –æ–±—É—á–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--output`, `-o` | `output/detected.mp4` | –ü—É—Ç—å –∫ –≤—ã—Ö–æ–¥–Ω–æ–º—É –≤–∏–¥–µ–æ |
| `--csv`, `-c` | `output/detections.csv` | –ü—É—Ç—å –∫ CSV —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ |
| `--conf` | 0.25 | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0-1) |
| `--depth-rate` | None | –°–∫–æ—Ä–æ—Å—Ç—å –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è (–º/—Å) |
| `--ctd` | None | –ü—É—Ç—å –∫ CSV —Å –¥–∞–Ω–Ω—ã–º–∏ CTD |
| `--no-video` | False | –ù–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –≤–∏–¥–µ–æ |

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç—Ä–µ–∫–∏–Ω–≥–∞

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--track` | False | –í–∫–ª—é—á–∏—Ç—å —Ç—Ä–µ–∫–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–æ–≤ |
| `--tracker` | `bytetrack.yaml` | –¢–∏–ø —Ç—Ä–µ–∫–µ—Ä–∞ (bytetrack.yaml / botsort.yaml) |
| `--show-trails` | False | –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è |
| `--trail-length` | 30 | –î–ª–∏–Ω–∞ —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –≤ –∫–∞–¥—Ä–∞—Ö |
| `--min-track-length` | 3 | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ —Ç—Ä–µ–∫–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è |

---

### 5. –ì–µ–æ–º–µ—Ç—Ä–∏—è –∫–∞–º–µ—Ä—ã –∏ —Ä–∞–∑–º–µ—Ä—ã (camera_geometry.py)

–ú–æ–¥—É–ª—å –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∫–∞–º–µ—Ä—ã –∏ —Ä–∞—Å—á—ë—Ç–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤.

#### –ü–æ–¥–∫–æ–º–∞–Ω–¥–∞: geometry

–û—Ü–µ–Ω–∫–∞ –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã –ø–æ Focus of Expansion.

```bash
python src/camera_geometry.py geometry \
    --video –ø—É—Ç—å/–∫/–≤–∏–¥–µ–æ.mp4 \
    --output output/geometry.csv \
    --interval 30
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--video`, `-v` | ‚Äî | –ü—É—Ç—å –∫ –≤–∏–¥–µ–æ—Ñ–∞–π–ª—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--output`, `-o` | `output/geometry.csv` | –í—ã—Ö–æ–¥–Ω–æ–π CSV |
| `--interval`, `-i` | 30 | –ò–Ω—Ç–µ—Ä–≤–∞–ª –∞–Ω–∞–ª–∏–∑–∞ –≤ –∫–∞–¥—Ä–∞—Ö |

**–í—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª** (`geometry.csv`):
- `frame_start`, `frame_end` ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω –∫–∞–¥—Ä–æ–≤
- `timestamp_s` ‚Äî –≤—Ä–µ–º—è –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- `foe_x`, `foe_y` ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã Focus of Expansion
- `tilt_horizontal_deg`, `tilt_vertical_deg` ‚Äî –Ω–∞–∫–ª–æ–Ω –∫–∞–º–µ—Ä—ã
- `confidence` ‚Äî —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏ (< 0.5 = –≤—ã–±—Ä–æ—Å)
- `n_vectors` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤

---

#### –ü–æ–¥–∫–æ–º–∞–Ω–¥–∞: size

–û—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –ø–æ —Ç—Ä–µ–∫–∞–º.

```bash
# –ë–∞–∑–æ–≤—ã–π –≤—ã–∑–æ–≤ (–∫–∞–º–µ—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π)
python src/camera_geometry.py size \
    --detections output/detections.csv \
    --output output/detections_with_size.csv \
    --tracks output/track_sizes.csv

# –° –∫–æ—Ä—Ä–µ–∫—Ü–∏–µ–π –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã
python src/camera_geometry.py size \
    --detections output/detections.csv \
    --geometry output/geometry.csv \
    --output output/detections_with_size.csv

# –û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏—é –Ω–∞–∫–ª–æ–Ω–∞ (–¥–∞–∂–µ –µ—Å–ª–∏ –µ—Å—Ç—å geometry.csv)
python src/camera_geometry.py size \
    --detections output/detections.csv \
    --geometry output/geometry.csv \
    --no-tilt-correction
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--detections`, `-d` | ‚Äî | CSV —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--output`, `-o` | auto | CSV —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ + —Ä–∞–∑–º–µ—Ä—ã |
| `--tracks`, `-t` | auto | CSV —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Ç—Ä–µ–∫–æ–≤ |
| `--geometry`, `-g` | None | CSV —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π –∫–∞–º–µ—Ä—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `--width` | 3840 | –®–∏—Ä–∏–Ω–∞ –∫–∞–¥—Ä–∞ |
| `--height` | 2160 | –í—ã—Å–æ—Ç–∞ –∫–∞–¥—Ä–∞ |
| `--min-depth-change` | 0.1 | –ú–∏–Ω. –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–ª—É–±–∏–Ω—ã (–º) |
| `--min-track-points` | 3 | –ú–∏–Ω. —Ç–æ—á–µ–∫ –≤ —Ç—Ä–µ–∫–µ |
| `--apply-tilt-correction` | True | –ü—Ä–∏–º–µ–Ω—è—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏—é –Ω–∞–∫–ª–æ–Ω–∞ |
| `--no-tilt-correction` | ‚Äî | –û—Ç–∫–ª—é—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ü–∏—é –Ω–∞–∫–ª–æ–Ω–∞ |

**–ö–æ—Ä—Ä–µ–∫—Ü–∏—è –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã:**

–ï—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∞ –Ω–∞ —É–≥–æ–ª Œ∏ –æ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª–∏, —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ –ø—Ä–∏ –ø–æ–≥—Ä—É–∂–µ–Ω–∏–∏, —Ç–∞–∫ –∫–∞–∫ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–±–ª–∏–∂–µ–Ω–∏–µ —Å –æ–±—ä–µ–∫—Ç–æ–º —Å–æ—Å—Ç–∞–≤–ª—è–µ—Ç `Œîdepth √ó cos(Œ∏)`.

- **–ë–µ–∑ `--geometry`** ‚Äî –∫–∞–º–µ—Ä–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–π (Œ∏ = 0¬∞)
- **–° `--geometry`** ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ü–∏—è: `k_real = k_measured / cos(Œ∏)`

| –ù–∞–∫–ª–æ–Ω –∫–∞–º–µ—Ä—ã | –ö–æ—Ä—Ä–µ–∫—Ü–∏—è k |
|----------------|----------------|
| 0¬∞ (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ) | +0% |
| 15¬∞ | +3.5% |
| 30¬∞ | +15.5% |
| 45¬∞ | +41.4% |
| 60¬∞ | +100% |

**–ú–µ—Ç–æ–¥—ã –æ—Ü–µ–Ω–∫–∏ —Ä–∞–∑–º–µ—Ä–∞:**
1. **k_method** ‚Äî –ø–æ —É–¥–µ–ª—å–Ω–æ–º—É –ø—Ä–∏—Ä–æ—Å—Ç—É —Ä–∞–∑–º–µ—Ä–∞ (–Ω–∞–∏–ª—É—á—à–∏–π)
2. **fixed** ‚Äî –¥–ª—è –º–µ–ª–∫–∏—Ö –≤–∏–¥–æ–≤ (P. pileus)
3. **typical** ‚Äî –ø–æ —Ç–∏–ø–∏—á–Ω—ã–º —Ä–∞–∑–º–µ—Ä–∞–º –≤–∏–¥–∞ (fallback)

**–í—ã—Ö–æ–¥–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ –¥–µ—Ç–µ–∫—Ü–∏—è—Ö:**
- `estimated_size_mm` ‚Äî –æ—Ü–µ–Ω—ë–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–º–º)
- `estimated_size_cm` ‚Äî –æ—Ü–µ–Ω—ë–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä (—Å–º)
- `object_depth_m` ‚Äî –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –æ–±—ä–µ–∫—Ç–∞
- `distance_to_object_m` ‚Äî —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –æ–±—ä–µ–∫—Ç–∞
- `size_confidence` ‚Äî —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏
- `size_method` ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥

**–§–∞–π–ª —Ç—Ä–µ–∫–æ–≤** (`track_sizes.csv`):
- `track_id`, `class_name` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `real_size_mm`, `real_size_cm` ‚Äî —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞
- `distance_m` ‚Äî –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –¥–æ –æ–±—ä–µ–∫—Ç–∞ –ø—Ä–∏ –º–∞–∫—Å. —Ä–∞–∑–º–µ—Ä–µ
- `object_depth_m` ‚Äî –≥–ª—É–±–∏–Ω–∞ –æ–±—ä–µ–∫—Ç–∞ –≤ —Å—Ç–æ–ª–±–µ –≤–æ–¥—ã
- `k_mean_pct_per_m`, `k_std_pct_per_m` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ k (%/–º)
- `method`, `confidence` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- `warnings` ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è `tilt_corrected_XXdeg` –µ—Å–ª–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ü–∏—è)

---

#### –ü–æ–¥–∫–æ–º–∞–Ω–¥–∞: volume

–†–∞—Å—á—ë—Ç –æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–≥–æ –æ–±—ä—ë–º–∞ –≤–æ–¥—ã –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤.

```bash
python src/camera_geometry.py volume \
    --detections output/detections.csv \
    --tracks output/track_sizes.csv \
    --ctd ctd_data.csv \
    --output output/volume.csv \
    --fov 100 \
    --near-distance 0.3
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--detections`, `-d` | ‚Äî | CSV —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--tracks`, `-t` | None | CSV —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Ç—Ä–µ–∫–æ–≤ |
| `--ctd`, `-c` | None | CSV —Å –¥–∞–Ω–Ω—ã–º–∏ CTD (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –≥–ª—É–±–∏–Ω) |
| `--output`, `-o` | auto | –í—ã—Ö–æ–¥–Ω–æ–π CSV |
| `--fov` | 100.0 | –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π FOV –∫–∞–º–µ—Ä—ã (¬∞) |
| `--near-distance` | 0.3 | –ë–ª–∏–∂–Ω—è—è –≥—Ä–∞–Ω–∏—Ü–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (–º) |
| `--detection-distance` | None | –î–∏—Å—Ç–∞–Ω—Ü–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è (–º), None = –∞–≤—Ç–æ |
| `--depth-min` | None | –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ (–º) |
| `--depth-max` | None | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ (–º) |
| `--duration` | None | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ (—Å) |
| `--fps` | 60.0 | –ß–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä–æ–≤ |
| `--width` | 1920 | –®–∏—Ä–∏–Ω–∞ –∫–∞–¥—Ä–∞ |
| `--height` | 1080 | –í—ã—Å–æ—Ç–∞ –∫–∞–¥—Ä–∞ |

**–í–∞–∂–Ω–æ:** –û–±—ä—ë–º —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ –í–°–ï–ú–£ –¥–∏–∞–ø–∞–∑–æ–Ω—É –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è. –ü—É—Å—Ç–∞—è –≤–æ–¥–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á—ë—Ç–∞ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏.

**–í—ã—Ö–æ–¥–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `total_volume_m3` ‚Äî –æ–±—â–∏–π –æ—Å–º–æ—Ç—Ä–µ–Ω–Ω—ã–π –æ–±—ä—ë–º (–º¬≥)
- `frustum_volume_m3` ‚Äî –æ–±—ä—ë–º –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ frustum
- `swept_volume_m3` ‚Äî –æ–±—ä—ë–º –ø—Ä–æ–π–¥–µ–Ω–Ω—ã—Ö —Å–ª–æ—ë–≤
- `depth_min_m`, `depth_max_m` ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω –≥–ª—É–±–∏–Ω
- `detection_distance_m` ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –¥–∏—Å—Ç–∞–Ω—Ü–∏—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è
- `cross_section_area_m2` ‚Äî –ø–ª–æ—â–∞–¥—å —Å–µ—á–µ–Ω–∏—è
- `count_<Species>` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Å–æ–±–µ–π –ø–æ –≤–∏–¥–∞–º
- `density_<Species>_per_m3` ‚Äî –ø–ª–æ—Ç–Ω–æ—Å—Ç—å (–æ—Å–æ–±–µ–π/–º¬≥)

---

### 6. –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (analyze.py)

–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤.

```bash
python src/analyze.py --csv output/detections.csv --output-dir output --depth-bin 2.0
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--csv`, `-c` | ‚Äî | –ü—É—Ç—å –∫ CSV —Å –¥–µ—Ç–µ–∫—Ü–∏—è–º–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--output-dir`, `-o` | `output/` | –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ |
| `--depth-bin` | 1.0 | –®–∞–≥ –±–∏–Ω–Ω–∏–Ω–≥–∞ –ø–æ –≥–ª—É–±–∏–Ω–µ (–º) |
| `--report` | `report.txt` | –ò–º—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞ |

**–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `vertical_distribution.png` ‚Äî –ø—Ä–æ—Ñ–∏–ª—å –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- `detection_timeline.png` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –¥–µ—Ç–µ–∫—Ü–∏–π
- `species_summary.png` ‚Äî —Å–≤–æ–¥–∫–∞ –ø–æ –≤–∏–¥–∞–º
- `report.txt` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π –æ—Ç—á—ë—Ç

---

### 7. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è (interactive_plot.py)

–ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ HTML-–≥—Ä–∞—Ñ–∏–∫–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤ –ø–æ –≥–ª—É–±–∏–Ω–µ —Å –Ω–∞–ª–æ–∂–µ–Ω–∏–µ–º CTD-–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç Plotly.

```bash
# –ë–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π HTML
python src/interactive_plot.py \
    --track-sizes output/dive001_detections_track_sizes.csv \
    --output output/depth_plot

# –° CTD –¥–∞–Ω–Ω—ã–º–∏ (–∫–æ–ª–æ–Ω–∫–∏ 6 –∏ 7)
python src/interactive_plot.py \
    --track-sizes output/dive001_detections_track_sizes.csv \
    --ctd ctd_data.csv \
    --ctd-columns 6,7 \
    --output output/depth_plot

# –≠–∫—Å–ø–æ—Ä—Ç –≤ SVG –∏–ª–∏ PDF (—Ç—Ä–µ–±—É–µ—Ç kaleido)
python src/interactive_plot.py \
    --track-sizes output/dive001_detections_track_sizes.csv \
    --format svg \
    --output output/depth_plot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–ª–æ–Ω–æ–∫ CTD-—Ñ–∞–π–ª–∞
python src/interactive_plot.py --ctd ctd_data.csv --list-ctd-columns
```

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|--------------|----------|
| `--track-sizes`, `-t` | ‚Äî | CSV —Å–æ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π —Ç—Ä–µ–∫–æ–≤ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π) |
| `--output`, `-o` | `output/depth_plot` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è |
| `--depth-bin` | 1.0 | –®–∞–≥ –±–∏–Ω–Ω–∏–Ω–≥–∞ –ø–æ –≥–ª—É–±–∏–Ω–µ (–º) |
| `--title` | –∞–≤—Ç–æ | –ó–∞–≥–æ–ª–æ–≤–æ–∫ –≥—Ä–∞—Ñ–∏–∫–∞ |
| `--format`, `-f` | `html` | –§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞: `html`, `svg`, `pdf`, `png` |
| `--ctd` | None | CSV —Å –¥–∞–Ω–Ω—ã–º–∏ CTD (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) |
| `--ctd-columns` | ‚Äî | –ù–æ–º–µ—Ä–∞ –∫–æ–ª–æ–Ω–æ–∫ CTD (0-based), —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é: `5,6,7` |
| `--list-ctd-columns` | ‚Äî | –í—ã–≤–µ—Å—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ CTD-—Ñ–∞–π–ª–∞ –∏ –≤—ã–π—Ç–∏ |

> –ü—Ä–∏ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤—Å–µ–≥–¥–∞ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è `.html`.
> –î–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ SVG/PDF/PNG —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: `pip install kaleido`

**–í—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª** (`track_sizes.csv`) ‚Äî –≤—ã—Ö–æ–¥–Ω–æ–π —Ñ–∞–π–ª –ø–æ–¥–∫–æ–º–∞–Ω–¥—ã `size` camera_geometry.py:
- `track_id` ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç—Ä–µ–∫–∞
- `class_name` ‚Äî –Ω–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–∞
- `real_size_cm` ‚Äî —Ä–∞–∑–º–µ—Ä –æ–±—ä–µ–∫—Ç–∞ (—Å–º)
- `object_depth_m` ‚Äî –≥–ª—É–±–∏–Ω–∞ –æ–±—ä–µ–∫—Ç–∞ –≤ —Å—Ç–æ–ª–±–µ –≤–æ–¥—ã

**–°–ª–æ–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫–µ:**
- **–ß–∏—Å–ª–µ–Ω–Ω–æ—Å—Ç—å (N)** ‚Äî –ª–∏–Ω–∏–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ø–æ –≥–ª—É–±–∏–Ω–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–∏–¥–∞
- **–†–∞–∑–º–µ—Ä—ã** ‚Äî —Ç–æ—á–∫–∏ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤ (–ø–ª–æ—â–∞–¥—å –º–∞—Ä–∫–µ—Ä–∞ –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ —Ä–∞–∑–º–µ—Ä—É)
- **CTD –ø–∞—Ä–∞–º–µ—Ç—Ä—ã** ‚Äî –ø—É–Ω–∫—Ç–∏—Ä–Ω—ã–µ –ª–∏–Ω–∏–∏ CTD-–ø—Ä–æ—Ñ–∏–ª–µ–π, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∫ –æ—Å–∏ X

**–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å (HTML):**
- –ö–ª–∏–∫ –ø–æ —ç–ª–µ–º–µ–Ω—Ç—É –ª–µ–≥–µ–Ω–¥—ã ‚Äî —Å–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å
- –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –≥—Ä—É–ø–ø—ã ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ —ç—Ç—É –≥—Ä—É–ø–ø—É
- –ö–æ–ª—ë—Å–∏–∫–æ –º—ã—à–∏ ‚Äî –º–∞—Å—à—Ç–∞–±
- –ù–∞–≤–µ–¥–µ–Ω–∏–µ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å batch-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:**
–®–∞–≥ ¬´üìä –ê–Ω–∞–ª–∏–∑¬ª –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å—Ç—Ä–æ–∏—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Ñ–∞–π–ª —Ç—Ä–µ–∫–æ–≤ —Å —Ä–∞–∑–º–µ—Ä–∞–º–∏. CTD-–∫–æ–ª–æ–Ω–∫–∏ –∑–∞–¥–∞—é—Ç—Å—è –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø–æ–¥–∑–∞–¥–∞—á–∏ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–ª–æ–Ω–∫–∞ `6`).

---

## –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è

### –ß–µ—Ä–µ–∑ GUI (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ó–∞–ø—É—Å—Ç–∏—Ç—å `python batch_app.py`
2. –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–µ–¥–∏—Ü–∏—é: **+ –≠–∫—Å–ø–µ–¥–∏—Ü–∏—è**
3. –î–æ–±–∞–≤–∏—Ç—å –ø–∞–ø–∫—É —Å –ø–æ–≥—Ä—É–∂–µ–Ω–∏–µ–º: **+ –ü–∞–ø–∫–∞** ‚Üí —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å
4. –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å: **–§–∞–π–ª ‚Üí –î–æ–±–∞–≤–∏—Ç—å –º–æ–¥–µ–ª—å**
5. –í—ã–±—Ä–∞—Ç—å –≤–∏–¥–µ–æ ‚Üí –ø—Ä–∞–≤—ã–π –∫–ª–∏–∫ ‚Üí **–î–æ–±–∞–≤–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å**
6. –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å: **F5**
7. –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏: **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ì–µ–æ–º–µ—Ç—Ä–∏—è –∏ —Ä–∞–∑–º–µ—Ä—ã**
8. –ê–Ω–∞–ª–∏–∑: **–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã ‚Üí –ê–Ω–∞–ª–∏–∑ –¥–µ—Ç–µ–∫—Ü–∏–π**

### –ß–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É

```bash
# 1. –î–µ—Ç–µ–∫—Ü–∏—è —Å —Ç—Ä–µ–∫–∏–Ω–≥–æ–º
python src/detect_video.py \
    --video dive_001.mp4 \
    --model best.pt \
    --track \
    --ctd ctd_data.csv \
    --csv output/dive001_detections.csv

# 2. –û—Ü–µ–Ω–∫–∞ –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã
python src/camera_geometry.py geometry \
    --video dive_001.mp4 \
    --output output/geometry.csv

# 3. –†–∞—Å—á—ë—Ç —Ä–∞–∑–º–µ—Ä–æ–≤
python src/camera_geometry.py size \
    --detections output/dive001_detections.csv \
    --geometry output/geometry.csv

# 4. –†–∞—Å—á—ë—Ç –æ–±—ä—ë–º–∞ –∏ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏
python src/camera_geometry.py volume \
    --detections output/dive001_detections_with_size.csv \
    --tracks output/dive001_detections_track_sizes.csv \
    --ctd ctd_data.csv

# 5. –ê–Ω–∞–ª–∏–∑ –∏ –≥—Ä–∞—Ñ–∏–∫–∏
python src/analyze.py \
    --csv output/dive001_detections_with_size.csv \
    --output-dir output/analysis \
    --depth-bin 2.0

# 6. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å CTD
python src/interactive_plot.py \
    --track-sizes output/dive001_detections_track_sizes.csv \
    --ctd ctd_data.csv \
    --ctd-columns 6 \
    --output output/analysis/depth_interactive
```

---

## –§–æ—Ä–º–∞—Ç—ã –¥–∞–Ω–Ω—ã—Ö

### –§–æ—Ä–º–∞—Ç CTD

CSV —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º (–∑–∞–ø—è—Ç–∞—è, —Ç–æ—á–∫–∞ —Å –∑–∞–ø—è—Ç–æ–π –∏–ª–∏ `|`):

```csv
time,depth,temperature,salinity
0.0,0.0,24.5,18.2
1.0,0.5,24.3,18.2
2.0,1.0,24.1,18.3
```

–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏: `time`, `depth`  
–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ: `temperature`, `salinity`

### –§–æ—Ä–º–∞—Ç –¥–µ—Ç–µ–∫—Ü–∏–π

```csv
frame,timestamp_s,depth_m,track_id,class_id,class_name,confidence,x_center,y_center,width,height
0,0.00,0.0,1,0,Aurelia aurita,0.89,0.453,0.621,0.124,0.098
```

### –§–æ—Ä–º–∞—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç—Ä–µ–∫–æ–≤

```csv
track_id,class_id,class_name,first_frame,last_frame,duration_s,detections_count,avg_confidence
1,0,Aurelia aurita,0,45,1.50,42,0.893
```

---

## –†–µ—à–µ–Ω–∏–µ —Ç–∏–ø–∏—á–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º

### –ú–Ω–æ–≥–æ –ª–æ–∂–Ω—ã—Ö —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–π –Ω–∞ –≤–∑–≤–µ—Å–∏
- –£–≤–µ–ª–∏—á—å—Ç–µ –ø–æ—Ä–æ–≥ `--conf` –¥–æ 0.4-0.5
- –î–æ–±–∞–≤—å—Ç–µ –∫–ª–∞—Å—Å "—á–∞—Å—Ç–∏—Ü–∞" –≤ –æ–±—É—á–∞—é—â–∏–π –¥–∞—Ç–∞—Å–µ—Ç

### –ù–µ—Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∞–∫–ª–æ–Ω–∞ –∫–∞–º–µ—Ä—ã
- FOE –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –≤—ã–±—Ä–æ—Å—ã (confidence < 0.5)
- –ü—Ä–∏ –º–∞–ª–æ–º –¥–≤–∏–∂–µ–Ω–∏–∏ –∫–∞–º–µ—Ä—ã –Ω–∞–∫–ª–æ–Ω –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ

### –ü–ª–æ—Ö–∞—è –æ—Ü–µ–Ω–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
- –ù—É–∂–Ω–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≥–ª—É–±–∏–Ω–∞ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è (> 0.1 –º –∏–∑–º–µ–Ω–µ–Ω–∏—è)
- –î–ª—è fallback –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–∏–ø–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –≤–∏–¥–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `method` –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö: `k_method` ‚Äî –ª—É—á—à–∏–π
- –ï—Å–ª–∏ –∫–∞–º–µ—Ä–∞ –Ω–∞–∫–ª–æ–Ω–µ–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `--geometry` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏
- –ü—Ä–∏ –Ω–∞–∫–ª–æ–Ω–µ > 30¬∞ —Ä–∞–∑–º–µ—Ä—ã –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–Ω–∏–∂–µ–Ω—ã –Ω–∞ 15%+ –±–µ–∑ –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏

### –ù–µ—Ö–≤–∞—Ç–∫–∞ –ø–∞–º—è—Ç–∏ GPU
- –£–º–µ–Ω—å—à–∏—Ç–µ `--batch` (8 –∏–ª–∏ 4)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–µ–Ω—å—à—É—é –º–æ–¥–µ–ª—å (yolov8s.pt)

---

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ
- Python 3.8+
- 8 GB RAM
- CPU

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ
- Python 3.10+
- 16+ GB RAM
- NVIDIA GPU —Å 8+ GB VRAM
- CUDA 11.8+

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```
ultralytics>=8.0.0
opencv-python>=4.8.0
numpy>=1.24.0
pandas>=2.0.0
matplotlib>=3.7.0
albumentations>=1.3.0
torch>=2.0.0
scipy>=1.10.0
sqlalchemy>=2.0.0
PyQt6>=6.4.0
```

---

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ê–≤—Ç–æ—Ä

–ü—Ä–æ–µ–∫—Ç –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∂–µ–ª–µ—Ç–µ–ª–æ–≥–æ –º–∞–∫—Ä–æ–∑–æ–æ–ø–ª–∞–Ω–∫—Ç–æ–Ω–∞ –≤ –ß—ë—Ä–Ω–æ–º –º–æ—Ä–µ.
